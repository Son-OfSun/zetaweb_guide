# Установка веб-части

Первичная установка продукта требует ряда специализированных знаний и может быть выполнена самостоятельно при условии наличия определенной квалификации.

На сервере, где размещается ваш сайт, должен быть установлен IIS версии 7.0 и выше, .NET Framework версии 4.5. 

А также, прежде всего, необходимо перенести папку с дистрибутивом Zeta Web на локальный диск сервера.

## Создание базы данных \(далее - БД\) сайта

Для создания базы необходимо выполнить следующую последовательность действий:

1\) Создать чистую БД для сайта в MS SQL

Запустить _**Microsoft SQL Server Managment Studio**_

![](../.gitbook/assets/image-26.png)

В левой части панели открывшегося окна, нажав правой кнопкой мыши на папку **Базы данных** необходимо выбрать **Создать базу данных,** а в поле **Имя базы данных** внести наименование сайта.

![](../.gitbook/assets/image-27.png)

  
Загрузить в БД бэкап из поставки \(в папке установки в каталоге DB файл с именем в формате «zetaweb-конфигурация-release-номер релиза.bak»\)

{% hint style="info" %}
Динамический контент приводит к фрагментации таблиц БД, что, в свою очередь, прямо влияет на производительность сайта. 

Для поддержания производительности, а также для обеспечения сохранности данных в случае технического сбоя следует:

* Настроить регламентные операции по дефрагментации и реиндексации таблиц БД и таблиц статистик \([пример листинга таких операций приведен в разделе «Техническая документация»](../reglamentnye-operacii.md)\)
* Настроить план обслуживания по архивному копированию БД
{% endhint %}

### Размещение файлов сайта и настройка IIS

Для развертывания файлов сайта необходимо:

* Создать сайт в панели Диспетчер служб IIS \(в пуле должно быть выбрано .NET FrameWork, версии 4.0\)
* Разместить в папке сайта файлы из папки cms в поставке, дать на них доступ на изменение для пользователя «IIS\_IUSRS» на закладке Безопасность добавить пользователя и установить флаг Полный доступ.
* В созданном сайте \(IIS\) сконвертировать в приложение каталог «TransferService», представляющую собой сервис обмена: -преобразовать в приложение

![](../.gitbook/assets/image%20%28567%29.png)

{% hint style="info" %}
Как правило, рекомендуется использовать отдельный пул для сервиса обмена сайта _\(например, создать отдельный пул "+exchange" к его имени\)_
{% endhint %}

* Перенести в корневую папку из папки configs файлы:

  * WebConnection.config
  * WebSettings.config

* Прописать в файле «WebConnection.config» пути доступа к SQL-базе сайта:

![](../.gitbook/assets/image%20%28273%29.png)

 

* Заполнить bindings именами доменов: - если их несколько

![](../.gitbook/assets/image%20%28280%29.png)

* Перезапустить сайт:

![](../.gitbook/assets/image%20%28243%29.png)

После выполненных действий необходимо перейти в 1С, установить [настройки параметров обмена с сайтом](nastroiki-saita-posle-zagruzki-nachalnykh-dannykh-i-tipovogo-dizaina.md) и произвести выгрузку данных.

### Установка API 2.0

Начиная с версии веб-части 2.4.10.0 в комплект поставки входят файлы для развертывания API 2.0 \(данные файлы расположены в каталоге "core"\).

Перед обновление файлов сайта до версии 2.4.10.0 и выше требуется настройка сервера:

* Скачать и установить на сервере где размещается сайт **Runtime & Hosting Bundle** с сайта [https://dotnet.microsoft.com/download/dotnet-core/2.2  ](https://dotnet.microsoft.com/download/dotnet-core/2.2  )

![&#x418;&#x43D;&#x444;&#x43E;&#x440;&#x43C;&#x430;&#x446;&#x438;&#x43E;&#x43D;&#x43D;&#x43E;&#x435; &#x43E;&#x43A;&#x43D;&#x43E; &#x43E;&#x431; &#x443;&#x441;&#x43F;&#x435;&#x448;&#x43D;&#x43E;&#x439; &#x443;&#x441;&#x442;&#x430;&#x43D;&#x43E;&#x432;&#x43A;&#x435; .NET Core 2.2.5 WSH](../.gitbook/assets/image%20%28211%29.png)

После обновления файлов сайта до версии 2.4.10.0 и выше требуется дополнительная настройка приложения.

* Открыть файл **WebSettings.config** в корневом каталоге приложения и добавить в конец файла следующую строку: 

```text
<add key="ApiUrl" value="/core" />
```

В качестве значения атрибута **value** можно указать относительный или абсолютный путь к каталогу API 2.0. В приведенном примере указан относительный путь к каталогу API 2.0 по умолчанию: /core.  
Сохранить изменения.  


![&#x418;&#x437;&#x43C;&#x435;&#x43D;&#x435;&#x43D;&#x438;&#x44F; &#x432; &#x444;&#x430;&#x439;&#x43B;&#x435; WebSettings.config](../.gitbook/assets/image%20%28259%29.png)

* Добавить в каталог /core файл connectionStrings.json в теле которого разместить следующий текст: 

```text
{
  "ConnectionStrings": {
    "ZetaWebInfrastructureDbContext": "Server=SSS;Database=DDD;Integrated Security=False;User Id=UUU;Password=PPP;MultipleActiveResultSets=true;"
  }
}
```

Где SSS - адрес сервера БД, DDD - имя базы данных сайта, UUU - имя пользователя сервера БД, PPP - пароль пользователя БД.  
Сохранить изменения.

![&#x41D;&#x430;&#x43F;&#x43E;&#x43B;&#x43D;&#x435;&#x43D;&#x438;&#x435; &#x444;&#x430;&#x439;&#x43B;&#x430; connectionStrings.json](../.gitbook/assets/image%20%28548%29.png)

* Создать новый Пул приложений \(Application Pool\) как указано на картинке ниже

![&#x421;&#x43E;&#x437;&#x434;&#x430;&#x43D;&#x438;&#x435; &#x43F;&#x443;&#x43B;&#x430; &#x43F;&#x440;&#x438;&#x43B;&#x43E;&#x436;&#x435;&#x43D;&#x438;&#x439; &#x434;&#x43B;&#x44F; API 2.0](../.gitbook/assets/image%20%28136%29.png)

* Сконвертировать в приложение каталог **core** в дереве файлов сайта

![&#x41A;&#x43E;&#x43D;&#x432;&#x435;&#x440;&#x442;&#x430;&#x446;&#x438;&#x44F; &#x43A;&#x430;&#x442;&#x430;&#x43B;&#x43E;&#x433;&#x430; core &#x432; &#x43F;&#x440;&#x438;&#x43B;&#x43E;&#x436;&#x435;&#x43D;&#x438;&#x435;](../.gitbook/assets/image%20%28292%29.png)

* Указать в создаваемом приложении ранее созданный пул приложений

![&#x412;&#x44B;&#x431;&#x43E;&#x440; &#x43F;&#x443;&#x43B;&#x430; &#x43F;&#x440;&#x438;&#x43B;&#x43E;&#x436;&#x435;&#x43D;&#x438;&#x439; &#x434;&#x43B;&#x44F; &#x43F;&#x440;&#x438;&#x43B;&#x43E;&#x436;&#x435;&#x43D;&#x438;&#x44F; API 2.0](../.gitbook/assets/image%20%28139%29.png)

* Открыть описание API 2.0 для проверки правильности настроек по адресу: **имя\_вашего\_сайта/core/docs/index.html**

![&#x41E;&#x43F;&#x438;&#x441;&#x430;&#x43D;&#x438;&#x435; &#x43C;&#x435;&#x442;&#x43E;&#x434;&#x43E;&#x432; API 2.0 &#x432; &#x444;&#x43E;&#x440;&#x43C;&#x430;&#x442;&#x435; Swagger](../.gitbook/assets/image%20%28369%29.png)

{% hint style="info" %}
Если что-то пошло не так...

После старта приложения в  каталоге /core/logs будет доступен файл с наименованием в формате yyyy-MM-dd.log.   
В данном файле содержатся описание процесса запуска приложения.
{% endhint %}

